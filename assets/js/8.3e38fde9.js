(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{326:function(s,t,a){"use strict";a.r(t);var n=a(33),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"构建与部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建与部署"}},[s._v("#")]),s._v(" 构建与部署")]),s._v(" "),a("h2",{attrs:{id:"后台服务的部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后台服务的部署"}},[s._v("#")]),s._v(" 后台服务的部署")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://eggjs.org/zh-cn/core/deployment.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("egg部署文档"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"前台的部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前台的部署"}},[s._v("#")]),s._v(" 前台的部署")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://pro.ant.design/docs/build-cn",target:"_blank",rel:"noopener noreferrer"}},[s._v("antd-design-pro构建和部署"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"构建部署示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建部署示例"}},[s._v("#")]),s._v(" 构建部署示例")]),s._v(" "),a("h3",{attrs:{id:"导出项目sql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导出项目sql"}},[s._v("#")]),s._v(" 导出项目sql")]),s._v(" "),a("p",[s._v("在jsyang-admin根目录执行如下命令")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mysqldump --column-statistics"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -u root -p jsyang_admin "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" jsyang_admin.sql\n")])])]),a("p",[s._v("就会在目录下生成"),a("code",[s._v("jsyang_admin.sql")]),s._v("文件")]),s._v(" "),a("h3",{attrs:{id:"将导出的sql文件传入服务器中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将导出的sql文件传入服务器中"}},[s._v("#")]),s._v(" 将导出的sql文件传入服务器中")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r jsyang_admin.sql  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("target_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("h3",{attrs:{id:"登录到服务器中，登录mysql，创建数据库，导入数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录到服务器中，登录mysql，创建数据库，导入数据"}},[s._v("#")]),s._v(" 登录到服务器中，登录mysql，创建数据库，导入数据")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" CREATE DATABASE "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("jsyang_admin"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" CHARACTER SET utf8 COLLATE utf8_general_ci"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row affected "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.03")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use jsyang_admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nDatabase changed\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /tmp/jsyang_admin.sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## /tmp/jsyang_admin.sql is the target path you send your sql")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show tables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Tables_in_jsyang_admin "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" admins                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" goods                  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sequelizemeta          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" students               "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h3",{attrs:{id:"将项目拉到服务器中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将项目拉到服务器中"}},[s._v("#")]),s._v(" 将项目拉到服务器中")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM_0_7_centos project"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# git clone https://github.com/jsyang666/jsyang-admin.git")]),s._v("\n")])])]),a("h3",{attrs:{id:"安装后台服务生产依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装后台服务生产依赖"}},[s._v("#")]),s._v(" 安装后台服务生产依赖")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM_0_7_centos project"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" jsyang-admin/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM_0_7_centos jsyang-admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" i --production\n")])])]),a("h3",{attrs:{id:"如果服务器的mysql密码和代码中的生产配置不同，记得修改一下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如果服务器的mysql密码和代码中的生产配置不同，记得修改一下"}},[s._v("#")]),s._v(" 如果服务器的mysql密码和代码中的生产配置不同，记得修改一下")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM_0_7_centos jsyang-admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" config/config.prod.js\n")])])]),a("h3",{attrs:{id:"启动后台服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动后台服务"}},[s._v("#")]),s._v(" 启动后台服务")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM_0_7_centos jsyang-admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" start\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" server@1.0.0 start /project/jsyang-admin\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" egg-scripts start --daemon --title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("egg-server-server\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("egg-scripts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting egg application at /project/jsyang-admin\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("egg-scripts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Run node /project/jsyang-admin/node_modules/egg-scripts/lib/start-cluster "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"egg-server-server"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"baseDir"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/project/jsyang-admin"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"framework"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/project/jsyang-admin/node_modules/egg"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" --title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("egg-server-server\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("egg-scripts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Save log "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" to /root/logs\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("egg-scripts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Wait Start: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("egg-scripts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Wait Start: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("egg-scripts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" egg started on http://127.0.0.1:7001\n")])])]),a("p",[s._v("看到"),a("code",[s._v("egg started on http://127.0.0.1:7001")]),s._v("说明后台服务已经启动成功")]),s._v(" "),a("h3",{attrs:{id:"构建前台项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建前台项目"}},[s._v("#")]),s._v(" 构建前台项目")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM_0_7_centos jsyang-admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" config/config.prod.js\n")])])]),a("h3",{attrs:{id:"将构建完的前台包发送到服务器中的nginx目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将构建完的前台包发送到服务器中的nginx目录"}},[s._v("#")]),s._v(" 将构建完的前台包发送到服务器中的nginx目录")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -r dist/*  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nginx_page_path_of_jsyang_admin_front"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("h3",{attrs:{id:"配置nginx端口转发，将前台的-server-api-xxx请求转发到localhost-7001-api-xxx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置nginx端口转发，将前台的-server-api-xxx请求转发到localhost-7001-api-xxx"}},[s._v("#")]),s._v(" 配置nginx端口转发，将前台的"),a("code",[s._v("/server/api/xxx")]),s._v("请求转发到"),a("code",[s._v("localhost:7001/api/xxx")])]),s._v(" "),a("p",[s._v("在nginx配置增加一个server")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## the site of you site")]),s._v("\n                server_name  jsyang-admin.huangyanyang.cn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## the path you save jsyang-admin front end build code")]),s._v("\n                root /var/www/jsyang-admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        try_files "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                location ^~ /server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        proxy_pass              http://127.0.0.1:7001"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        rewrite ^/server/api/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ /api/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        proxy_set_header        Host "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        proxy_set_header        X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        proxy_set_header        X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("配置完nginx记得重启nginx才能生效")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl restart nginx\n")])])]),a("p",[s._v("这样配置就已经完成了，当然，要想通过上面配置的 jsyang-admin.huangyanyang.cn访问JsyangAdmin，还得进行域名解析:\n"),a("a",{attrs:{"data-fancybox":"",title:"",href:"https://gitee.com/hyy930256283/imgbed/raw/master/blog/20200502222520.png"}},[a("img",{attrs:{src:"https://gitee.com/hyy930256283/imgbed/raw/master/blog/20200502222520.png",alt:""}})])]),s._v(" "),a("p",[s._v("这样，就大功告成了！使用浏览器访问"),a("a",{attrs:{href:"http://jsyang-admin.huangyanyang.cn",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://jsyang-admin.huangyanyang.cn"),a("OutboundLink")],1),s._v("试试吧")]),s._v(" "),a("blockquote",[a("p",[s._v("默认账号仍然为admin，密码为jsyang666")])])])}),[],!1,null,null,null);t.default=e.exports}}]);